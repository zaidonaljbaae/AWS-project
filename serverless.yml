service: aws-microservices-template

custom:
  stage: ${opt:stage, self:provider.stage}
  region: ${opt:region, self:provider.region}

# -----------------------------
# Safe defaults
# -----------------------------
# This project is a GENERIC, production-minded template.
# - No real secrets are stored in the repo.
# - All functions work even without DB/VPC/Cognito.
# - You can progressively enable VPC, DB, auth, etc.

params:
  dev:
    # Optional settings (leave empty to keep the template minimal)
    S3_BUCKET_NAME: ""         # e.g. my-dev-bucket
    DB_URL: ""                # e.g. postgresql+psycopg2://user:pass@host:5432/db

  prod:
    S3_BUCKET_NAME: ""
    DB_URL: ""

provider:
  name: aws
  runtime: python3.11
  region: ${self:custom.region}
  stage: ${opt:stage, 'dev'}
  logRetentionInDays: 30

  httpApi:
    cors: true

  # Optional: Put Lambdas inside a VPC (private subnets) when needed.
  # vpc:
  #   securityGroupIds:
  #     - Ref: LambdaSecurityGroup
  #   subnetIds: ${param:SUBNETIDS}

  environment:
    STAGE: ${self:custom.stage}
    S3_BUCKET_NAME: ${param:S3_BUCKET_NAME}
    DB_URL: ${param:DB_URL}

package:
  individually: true
  patterns:
    - '!__pycache__/**'
    - '!node_modules/**'

functions:
  example_api: ${file(src/app/example_api/example_api.yml)}
  print_lambda: ${file(src/app/print_lambda/print_lambda.yml)}

# Optional: resources for VPC SGs (enable if you enable provider.vpc)
# resources:
#   - ${file(resources/vpc/vpc.yml)}

plugins:
  - serverless-iam-roles-per-function
  - serverless-plugin-resource-tagging
